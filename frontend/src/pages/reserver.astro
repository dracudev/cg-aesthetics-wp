---
import Layout from '../layouts/Layout.astro';
import { Button } from '../components/ui/button';
import { Card, CardContent } from '../components/ui/card';
import { Calendar, Clock, CheckCircle2, Mail, Phone, MapPin } from 'lucide-react';

const WP_URL = import.meta.env.PUBLIC_WORDPRESS_URL || 'http://localhost:8000';
// Use page ID to ensure we get the correct page
const BOOKING_PAGE_URL = `${WP_URL}/?page_id=20`;

// SEO Configuration
const seoTitle = 'Réserver un Rendez-vous - CG Aesthetics | Booking en Ligne';
const seoDescription = 'Réservez votre soin esthétique en ligne. Choisissez votre service, date et heure préférés. Confirmation immédiate par email. Réservation simple et rapide.';
const seoCanonical = Astro.site ? new URL('/reserver', Astro.site).href : undefined;

// Schema.org for booking page
const bookingSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebPage',
  name: seoTitle,
  description: seoDescription,
  url: seoCanonical,
  isPartOf: {
    '@type': 'WebSite',
    name: 'CG Aesthetics',
    url: Astro.site?.href,
  },
  potentialAction: {
    '@type': 'ReserveAction',
    target: {
      '@type': 'EntryPoint',
      urlTemplate: seoCanonical,
      actionPlatform: [
        'http://schema.org/DesktopWebPlatform',
        'http://schema.org/MobileWebPlatform'
      ]
    },
    result: {
      '@type': 'Reservation',
      name: 'Spa Appointment'
    }
  }
};
---

<Layout 
  title={seoTitle}
  description={seoDescription}
  canonical={seoCanonical}
  type="website"
  schema={bookingSchema}
>
  <main>
    <!-- Hero Section -->
    <section class="relative overflow-hidden" style="background: linear-gradient(135deg, var(--color-primary-background) 0%, var(--color-secondary-gray-light) 100%);">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-20 md:py-32">
        <div class="max-w-4xl mx-auto text-center space-y-8">
          <div class="space-y-4">
            <p class="text-sm md:text-base font-medium tracking-[var(--letter-spacing-widest)] uppercase" style="color: var(--color-secondary-mauve);">
              Réservation en Ligne
            </p>
            <h1 
              class="text-4xl md:text-6xl lg:text-7xl font-[var(--font-weight-bold)] leading-[var(--line-height-tight)] tracking-[var(--letter-spacing-tight)]"
              style="font-family: var(--font-heading); color: var(--color-text-heading);"
            >
              Réservez Votre
              <span class="block mt-2" style="color: var(--color-accent-rose-gold);">Moment de Bien-être</span>
            </h1>
            <p 
              class="text-lg md:text-xl max-w-2xl mx-auto leading-[var(--line-height-relaxed)]"
              style="color: var(--color-text-muted); font-size: var(--font-size-body-lg);"
            >
              Choisissez votre soin, la date et l'heure qui vous conviennent. Réservation simple et confirmation immédiate.
            </p>
          </div>
        </div>
      </div>
      
      <!-- Decorative Element -->
      <div class="absolute bottom-0 left-0 right-0 h-px" style="background: linear-gradient(90deg, transparent, var(--color-secondary-gray), transparent);"></div>
    </section>

    <!-- Booking Form Section -->
    <section class="pt-4" style="background-color: var(--color-white);">


          <!-- Booking Form Card -->
          <Card client:visible className="border-0 shadow-[var(--shadow-medium)] overflow-hidden">
            <CardContent client:load className="p-0">
              <!-- Amelia Booking Form Iframe -->
              <iframe
                id="amelia-booking-iframe"
                src={BOOKING_PAGE_URL}
                title="Formulaire de réservation"
                class="w-full border-0"
                loading="lazy"
              ></iframe>
            </CardContent>
          </Card>


    </section>

    <!-- Contact Alternative -->
    <section class="py-16 md:py-24" style="background-color: var(--color-secondary-gray-light);">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="max-w-4xl mx-auto text-center space-y-8">
          <div class="space-y-4">
            <h2 
              class="text-3xl md:text-4xl font-[var(--font-weight-semibold)] tracking-[var(--letter-spacing-wide)]"
              style="font-family: var(--font-heading); color: var(--color-text-heading);"
            >
              Besoin d'Aide pour Réserver ?
            </h2>
            <p 
              class="text-lg leading-[var(--line-height-relaxed)]"
              style="color: var(--color-text-muted);"
            >
              Notre équipe est à votre disposition pour vous assister
            </p>
          </div>

          <div class="grid sm:grid-cols-3 gap-6 max-w-3xl mx-auto">
            <Card client:visible className="border-0 shadow-[var(--shadow-default)] hover:shadow-[var(--shadow-hover)] transition-all duration-300">
              <CardContent client:load className="p-6 text-center space-y-3">
                <div 
                  class="inline-flex p-3 rounded-full"
                  style="background-color: var(--color-primary-accent-light);"
                >
                  <Phone 
                    className="h-5 w-5 text-[var(--color-accent-rose-gold)]"
                  />
                </div>
                <h3 
                  class="text-base font-[var(--font-weight-semibold)]"
                  style="color: var(--color-text-heading);"
                >
                  Téléphone
                </h3>
                <a 
                  href="tel:+41763999732"
                  class="text-sm transition-colors hover:text-[var(--color-accent-rose-gold)]"
                  style="color: var(--color-text-muted);"
                >
                  +41 76 399 97 32
                </a>
              </CardContent>
            </Card>

            <Card client:visible className="border-0 shadow-[var(--shadow-default)] hover:shadow-[var(--shadow-hover)] transition-all duration-300">
              <CardContent client:load className="p-6 text-center space-y-3">
                <div 
                  class="inline-flex p-3 rounded-full"
                  style="background-color: var(--color-primary-accent-light);"
                >
                  <Mail 
                    className="h-5 w-5 text-[var(--color-accent-rose-gold)]"
                  />
                </div>
                <h3 
                  class="text-base font-[var(--font-weight-semibold)]"
                  style="color: var(--color-text-heading);"
                >
                  Email
                </h3>
                <a 
                  href="mailto:info@cgaesthetics.ch"
                  class="text-sm transition-colors hover:text-[var(--color-accent-rose-gold)]"
                  style="color: var(--color-text-muted);"
                >
                  info@cgaesthetics.ch
                </a>
              </CardContent>
            </Card>

            <Card client:visible className="border-0 shadow-[var(--shadow-default)] hover:shadow-[var(--shadow-hover)] transition-all duration-300">
              <CardContent client:load className="p-6 text-center space-y-3">
                <div 
                  class="inline-flex p-3 rounded-full"
                  style="background-color: var(--color-primary-accent-light);"
                >
                  <MapPin 
                    className="h-5 w-5 text-[var(--color-accent-rose-gold)]"
                  />
                </div>
                <h3 
                  class="text-base font-[var(--font-weight-semibold)]"
                  style="color: var(--color-text-heading);"
                >
                  Adresse
                </h3>
                <p 
                  class="text-sm"
                  style="color: var(--color-text-muted);"
                >
                  Avenue des Alpes, 60, Montreux, Suisse
                </p>
              </CardContent>
            </Card>
          </div>
        </div>
      </div>
    </section>

    <!-- Additional Info Section -->
    <section class="py-16 md:py-24" style="background-color: var(--color-white);">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="max-w-4xl mx-auto">
          <div class="text-center mb-12 space-y-4">
            <h2 
              class="text-3xl md:text-4xl font-[var(--font-weight-semibold)] tracking-[var(--letter-spacing-wide)]"
              style="font-family: var(--font-heading); color: var(--color-text-heading);"
            >
              Comment Ça Marche ?
            </h2>
          </div>

          <div class="grid md:grid-cols-3 gap-8">
            <div class="text-center space-y-4">
              <div 
                class="inline-flex items-center justify-center w-16 h-16 rounded-full text-2xl font-[var(--font-weight-bold)] text-white"
                style="background: linear-gradient(135deg, var(--color-accent-rose-gold) 0%, var(--color-secondary-mauve) 100%); font-family: var(--font-heading);"
              >
                1
              </div>
              <h3 
                class="text-xl font-[var(--font-weight-semibold)]"
                style="color: var(--color-text-heading); font-family: var(--font-body);"
              >
                Choisissez Votre Soin
              </h3>
              <p 
                class="text-sm leading-relaxed"
                style="color: var(--color-text-muted);"
              >
                Parcourez notre gamme de services et sélectionnez celui qui vous convient
              </p>
            </div>

            <div class="text-center space-y-4">
              <div 
                class="inline-flex items-center justify-center w-16 h-16 rounded-full text-2xl font-[var(--font-weight-bold)] text-white"
                style="background: linear-gradient(135deg, var(--color-accent-rose-gold) 0%, var(--color-secondary-mauve) 100%); font-family: var(--font-heading);"
              >
                2
              </div>
              <h3 
                class="text-xl font-[var(--font-weight-semibold)]"
                style="color: var(--color-text-heading); font-family: var(--font-body);"
              >
                Sélectionnez Date & Heure
              </h3>
              <p 
                class="text-sm leading-relaxed"
                style="color: var(--color-text-muted);"
              >
                Choisissez le créneau qui s'adapte le mieux à votre emploi du temps
              </p>
            </div>

            <div class="text-center space-y-4">
              <div 
                class="inline-flex items-center justify-center w-16 h-16 rounded-full text-2xl font-[var(--font-weight-bold)] text-white"
                style="background: linear-gradient(135deg, var(--color-accent-rose-gold) 0%, var(--color-secondary-mauve) 100%); font-family: var(--font-heading);"
              >
                3
              </div>
              <h3 
                class="text-xl font-[var(--font-weight-semibold)]"
                style="color: var(--color-text-heading); font-family: var(--font-body);"
              >
                Confirmez & Profitez
              </h3>
              <p 
                class="text-sm leading-relaxed"
                style="color: var(--color-text-muted);"
              >
                Recevez votre confirmation et préparez-vous à un moment unique
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</Layout>

<style>
  /* Iframe responsive adjustments */
  #amelia-booking-iframe {
    display: block;
    width: 100%;
    min-height: 600px;
  }

  /* Smooth iframe loading */
  #amelia-booking-iframe {
    transition: opacity var(--duration-default) var(--ease-elegant);
  }
</style>

<script>
  // Auto-resize iframe based on content
  const iframe = document.getElementById('amelia-booking-iframe') as HTMLIFrameElement;
  
  if (iframe) {
    // Listen for messages from iframe to adjust height
    window.addEventListener('message', (event) => {
      // Security check - only accept messages from our WordPress domain
      const wpUrl = import.meta.env.PUBLIC_WORDPRESS_URL || 'http://localhost:8000';
      if (event.origin !== wpUrl.replace(/\/$/, '')) return;
      
      if (event.data.type === 'ameliaHeight') {
        iframe.style.height = event.data.height + 'px';
      }
    });

    // Fallback: try to access iframe content height (works if same-origin)
    iframe.addEventListener('load', () => {
      try {
        const iframeDoc = iframe.contentDocument || iframe.contentWindow?.document;
        if (iframeDoc) {
          const height = iframeDoc.body.scrollHeight;
          iframe.style.height = height + 'px';
        }
      } catch (e) {
        // Cross-origin, can't access - use default height
        console.log('Cross-origin iframe, using default height');
      }
    });
  }
</script>
